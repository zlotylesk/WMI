<?php $this->headTitle('Strona główna'); ?>
<?php /* --- bootstrap banner carousel --- */ ?>
<div class="t-ac pad" style="padding-top: 20px">
<div id="carousel-wmi-captions" class="carousel slide mara" data-ride="carousel" style="width: 900px; height: 165px">
  <!-- Indicators --><?php /* --- kropeczki, których Leszek nie chce ;) ---*/
  /*
  <ol class="carousel-indicators">
    <li data-target="#carousel-wmi-captions" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-wmi-captions" data-slide-to="1"></li>
    <li data-target="#carousel-wmi-captions" data-slide-to="2"></li>
  </ol>
*/ 
  ?>
  <!-- Wrapper for slides -->
  <div class="carousel-inner">
      <?php        foreach ($this->slideshow as $k => $s){ ?>
    <div class="item <?php if ($k==0) echo "active"; ?> bg-c<?php echo rand(1,6); ?>">
        <?php /* --- tło w postaci grafiki --- */ ?>
        <img class="" src="<?php echo $this->baseUrl(); ?>/img/overlay.png" alt="">
      <div class="carousel-caption t0">
          <h1 class="mart47p"><a class="d-b w100 h100 p-a fc-f hov" href="<?php echo $this->url(array('action' => 'show', 'id' => $s['ad_id'])) ?>"><?php echo $s['topic'] ?></a></h1>

      </div>
    </div>
      <?php } ?>
  </div>

  <!-- Controls -->
  <a class="left carousel-control" href="#carousel-wmi-captions" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
  </a>
  <a class="right carousel-control" href="#carousel-wmi-captions" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
  </a>
</div>
</div>
<?php /* --- carousel stop --- */ ?>
<?php /* --- layout indexu --- */ ?>
<hr>
<?php 
$urls = array('action'=>'index');
foreach ($this->ad_sections as $k => $v) {
    if($v['page']>1 && $v['nr_per_page']<$v['count']){
        $urls[$k]=$v['page'];
    }
}
foreach ($this->ad_sections as $k => $data) { ?>
<h3><?php echo $data['section_name']; ?></h3>
<hr>
<?php foreach($data['ads'] as $ad): ?>
<?php if($ad['status'] != 0): ?>
<div class="h250p w27 fl p-r mar3 bgo clearDeco oh fc-f bg-c<?php echo rand(1,6); ?>">
    <a class="d-b w100 h100 p-a fc-f" href="<?php echo $this->url(array('action' => 'show', 'id' => $ad['ad_id'])) ?>">
        <div class="padlr20p"><?php /* --- topic & content --- */ ?>
            <h4><?php echo $ad['topic'] ?></h4>
            <p><?php if (strlen($ad['content']) <=300){
                   echo $ad['content'];
                }else {
                   echo $string2 = substr($ad['content'], 0, 300);echo'(...)';
                } ?></p>
        </div>
    </a>
    <div class="bg-r3 p-a b-100 fc-f w100 ad-panel an">
        <span class="d-ib pad10p fl">Autor: <?php echo $ad['username'] ?></span>
        <span class="d-ib pad10p fl"><?php echo $ad['datetime'] ?></span><?php /* --- date --- */ ?>
    <?php if($this->identity): ?>
        <?php if($this->identity->user_id == $ad['author'] || $this->identity->role == 'admin'): ?>
        <a class="fl b3psr3 padlr8p mar7p fc-f hbgr3" href="<?php echo $this->url(array('action' => 'edit', 'id' => $ad['ad_id'])) ?>">Edytuj</a>
        <a class="fl b3psr3 padlr8p mar7p fc-f hbgr3" href="<?php echo $this->url(array('action' => 'delete', 'id' => $ad['ad_id'])) ?>">Usuń</a>
        <?php endif; ?>
    <?php endif; ?>
    </div>
</div>
<?php endif; ?>
<?php endforeach; ?>
<?php if($data['nr_per_page']<$data['count']){ ?>
<div class="clf ta-c">
    <p class="padlr30p b3psr3 clearDeco d-ib bg-r3 fc-f fw-b">
    <?php 
    if ($data['page']!=1){
    ?>
        <a class="fc-f marlr6p" href="<?php $urls[$k]=$data['page']-1; echo $this->url($urls); ?>" >&lt;&lt;</a>
    <?php
    }
    for ($index = 1; $index <= $data['pages']; $index++) { 
        if($index==$data['page']){ ?>
        <span class="fc-f padlr6p bg-r3"><?php echo $index; ?></span>
        <?php }else{
       $urls[$k]=$index;
        ?>
    <a class="fc-f marlr6p" href="<?php echo $this->url($urls); ?>"><?php echo $index; ?></a>
        <?php }
        } if ($data['page']!=$data['pages']){
    ?>
    <a class="fc-f marlr6p" href="<?php $urls[$k]=$data['page']+1; echo $this->url($urls); ?>" >&gt;&gt;</a>
    <?php
    } ?>
    </p>
</div>
<hr>
<?php }else{ ?>
<hr class="clf">
<?php }?>
<?php } 
